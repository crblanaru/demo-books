name: ci

on:
  push:
    branches:
      - 'dev'

jobs:
  create-environment:
    runs-on: ubuntu-latest
    outputs:
      new_id: ${{ steps.clone-template.outputs.new_id }}
      env_unique: ${{ steps.clone-template.outputs.env_unique }}
    container:
        image: crblanaru/bunnyshell-cli:custom
    steps:
        - name: clone-template
          id: clone-template
          run: |
            bunnyshell-cli environments clone --id p2xKjb7EYM --token ${{ secrets.BUNNYSHELL_TOKEN }} --name "demobooks-${{ github.run_number }}" 2>&1 > bunnyresult
            cat bunnyresult
            new_id=$( cat bunnyresult | sed -nr 's/EnvironmentID.*\| (.*)/\1/p' )
            env_unique=$( cat bunnyresult | sed -nr 's/Namespace.*\| (.*)/\1/p' )
            echo "::set-output name=new_id::$new_id"
            echo "::set-output name=env_unique::$env_unique"
